<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8">

<head>
  <title>과목 검색</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <style>
    .result-container {
      display: flex;
      flex-direction: column;
      border: 1px solid #ddd;
      border-radius: 4px;
      height: 400px;
      border-left: 0;
      border-right: 0;
      border-radius: 0;
    }

    .result-header {
      display: grid;
      grid-template-columns: 0.5fr 2fr 2fr 1fr 1fr 1.5fr;
      gap: 20px;
      font-weight: bold;
      background-color: #f9f9f9;
      padding: 15px 20px;
      border-bottom: 1px solid #ddd;
    }

    .result-list {
      display: flex;
      flex-direction: column;
      flex: 1;
      overflow-y: auto;
      background-color: white;
      min-height: 200px;
    }

    .result-item {
      display: grid;
      grid-template-columns: 0.5fr 2fr 2fr 1fr 1fr 1.5fr;
      gap: 20px;
      padding: 15px 20px;
      border-bottom: 1px solid #ddd;
    }

    .result-item:hover {
      background-color: #f1f1f1;
    }

    .result-item>div,
    .result-header>div {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .result-item>div:first-child,
    .result-header>div:first-child {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .form-section {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
    }

    .form-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .form-group {
      flex: 1;
      margin-right: 10px;
    }

    .form-group:last-child {
      margin-right: 0;
    }

    .form-group input,
    .form-group select {
      width: 100%;
    }

    .button-group {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
    }

    .btn {
      height: 50%;
      /* 버튼 높이를 입력 필드와 동일하게 설정 */
    }

    .container {
      padding: 0;
      width: 100%;
      max-width: none;
      /* 부트스트랩의 max-width 제거 */
      margin: 0;
      /* 마진 제거 */
    }

    .search-section {
      margin: 0;
      border-radius: 0;
    }

    .form-section {
      margin-bottom: 0;
      padding: 15px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      border-left: 0;
      border-right: 0;
      border-radius: 0;
    }

    .search-form-container {
      margin-bottom: 20px;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 검색 섹션 컨테이너 -->
    <div class="search-section form-section">
      <div class="search-form-container">
        <form id="searchForm">
          <div class="form-row">
            <div class="form-group">
              <label for="subjectName">과목명</label>
              <input type="text" class="form-control" id="subjectName" name="subjectName" placeholder="과목명을 입력하세요">
            </div>
            <div class="form-group">
              <label for="curriculumName">교육과정명</label>
              <input type="text" class="form-control" id="curriculumName" name="curriculumName"
                placeholder="교육과정명을 입력하세요">
            </div>
            <div class="form-group d-flex align-items-end">
              <button type="submit" class="btn btn-primary mr-2">검색</button>
              <button type="button" id="selectButton" class="btn btn-success">선택</button>
            </div>
          </div>
        </form>
      </div>

      <div class="result-container">
        <div class="result-header">
          <div></div>
          <div>과목명</div>
          <div>교육과정명</div>
          <div>학점</div>
          <div>학기</div>
          <div>이수 구분</div>
        </div>
        <div class="result-list">
        </div>
      </div>
    </div>

    <!-- 강의 생성 폼 -->
    <form id="lectureForm" class="form-section">
      <div class="form-row">
        <div class="form-group">
          <label for="lectureName">강의명</label>
          <input type="text" class="form-control" id="lectureName" name="lectureName" placeholder="강의명을 입력하세요">
        </div>
        <div class="form-group">
          <label for="professorName">교수명</label>
          <input type="text" class="form-control" id="professorName" name="professorName" placeholder="교수명을 입력하세요">
        </div>
        <div class="form-group">
          <label for="maxStudents">인원수</label>
          <input type="number" class="form-control" id="maxStudents" name="maxStudents" placeholder="인원수를 입력하세요">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="lectureDays">강의 요일</label>
          <select class="form-control" id="lectureDays" name="lectureDays">
            <option value="MONDAY">월요일</option>
            <option value="TUESDAY">화요일</option>
            <option value="WEDNESDAY">수요일</option>
            <option value="THURSDAY">목요일</option>
            <option value="FRIDAY">금요일</option>
          </select>
        </div>
        <div class="form-group">
          <label for="lectureWeeks">강의 주차</label>
          <select class="form-control" id="lectureWeeks" name="lectureWeeks">
            <option value="15">15주차</option>
            <option value="16">16주차</option>
          </select>
        </div>
        <div class="form-group">
          <label for="startLectureTime">시작 교시</label>
          <select class="form-control" id="startLectureTime" name="startTime">
            <option value="1">1교시</option>
            <option value="2">2교시</option>
            <option value="3">3교시</option>
            <option value="4">4교시</option>
            <option value="5">5교시</option>
            <option value="6">6교시</option>
            <option value="7">7교시</option>
            <option value="8">8교시</option>
            <option value="9">9교시</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="endLectureTime">종료 교시</label>
          <select class="form-control" id="endLectureTime" name="endTime">
            <option value="1">1교시</option>
            <option value="2">2교시</option>
            <option value="3">3교시</option>
            <option value="4">4교시</option>
            <option value="5">5교시</option>
            <option value="6">6교시</option>
            <option value="7">7교시</option>
            <option value="8">8교시</option>
            <option value="9">9교시</option>
          </select>
        </div>
        <div class="form-group">
          <label for="selectedSubjectName">과목명</label>
          <input type="text" class="form-control" id="selectedSubjectName" name="subjectName" placeholder="선택한 과목명"
            readonly>
        </div>
        <div class="form-group">
          <label for="selectedCurriculumName">교육과정명</label>
          <input type="text" class="form-control" id="selectedCurriculumName" name="curriculumName"
            placeholder="선택한 교육과정명" readonly>
        </div>
      </div>
      <input type="hidden" id="curriculumSubjectId" name="curriculumSubjectId" />
      <div class="button-group">
        <button type="submit" class="btn btn-primary">강의 개설</button>
      </div>
    </form>
  </div>


  <script>
    $(document).ready(function () {
      $('#searchForm').on('submit', function (event) {
        event.preventDefault(); // 기본 폼 제출 방지
        const formData = $(this).serialize(); // 폼 데이터 직렬화

        $.ajax({
          url: '/api/curriculum-subjects/search',
          type: 'GET',
          data: formData,
          success: function (data) {
            const tbody = $('tbody');
            tbody.empty(); // 이전 결과 삭제

            if (data.length === 0) {
              alert('검색 결과가 없습니다.'); // alert 추가
            } else {
              // 검색 결과를 테이블에 추가
              data.forEach(function (subject) {
                $('.result-list').append(`
                <div class="result-item">
                    <div>
                        <input type="radio" class="subject-checkbox" name="selectedSubject"
                               data-subject-name="${subject.subjectName}"
                               data-curriculum-name="${subject.curriculumName}"
                               data-curriculum-subject-id="${subject.curriculumSubjectId}" />
                    </div>
                    <div>${subject.subjectName}</div>
                    <div>${subject.curriculumName || '정보 없음'}</div>
                    <div>${subject.subjectCredits || '정보 없음'}</div>
                    <div>${subject.semesterName || '정보 없음'}</div>
                    <div>${subject.subjectTypeName || '정보 없음'}</div>
                </div>
            `);
              });
            }
          },
          error: function () {
            alert('검색 중 오류가 발생했습니다.');
          }
        });
      });

      $('#selectButton').on('click', function () {
        const selectedSubject = $('.subject-checkbox:checked');
        if (selectedSubject.length === 0) {
          alert('선택된 과목이 없습니다.');
          return;
        }

        const subjectName = selectedSubject.data('subject-name');
        const curriculumName = selectedSubject.data('curriculum-name');
        const curriculumSubjectId = selectedSubject.data('curriculum-subject-id'); // ID 가져오기

        // 확인: 콘솔에 출력하여 값이 올바른지 확인
        console.log('Subject Name:', subjectName);
        console.log('Curriculum Name:', curriculumName);
        console.log('Curriculum Subject ID:', curriculumSubjectId);

        $('#selectedSubjectName').val(subjectName);
        $('#selectedCurriculumName').val(curriculumName);
        $('#curriculumSubjectId').val(curriculumSubjectId); // ID 설정
      });

      $('#lectureForm').on('submit', function (event) {
        event.preventDefault();

        const formData = {
          lectureName: $('#lectureName').val(),
          maxStudents: parseInt($('#maxStudents').val()),
          curriculumSubjectId: $('#curriculumSubjectId').val()
        };

        $.ajax({
          url: '/api/lecture/create',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify(formData),
          success: function (response) {
            alert(response); // 성공 메시지 표시

            // 폼 초기화
            $('#lectureForm')[0].reset();  // 일반 입력 필드 초기화

          },
          error: function (xhr) {
            alert(xhr.responseText);
          }
        });
      });
    });
  </script>
</body>

</html>