<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8">

<head>
  <title>과목 검색</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <style>
    .result-container {
      display: flex;
      flex-direction: column;
      border: 1px solid #ddd;
      border-radius: 4px;
      height: 400px;
      border-left: 0;
      border-right: 0;
      border-radius: 0;
    }

    .result-header {
      display: grid;
      grid-template-columns: 0.5fr 2fr 2fr 1fr 1fr 1.5fr;
      gap: 20px;
      font-weight: bold;
      background-color: #f9f9f9;
      padding: 15px 20px;
      border-bottom: 1px solid #ddd;
    }

    .result-list {
      display: flex;
      flex-direction: column;
      flex: 1;
      overflow-y: auto;
      background-color: white;
      min-height: 200px;
    }

    .result-item {
      display: grid;
      grid-template-columns: 0.5fr 2fr 2fr 1fr 1fr 1.5fr;
      gap: 20px;
      padding: 15px 20px;
      border-bottom: 1px solid #ddd;
    }

    .result-item:hover {
      background-color: #f1f1f1;
    }

    .result-item>div,
    .result-header>div {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .result-item>div:first-child,
    .result-header>div:first-child {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .form-section {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
    }

    .form-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .form-group {
      flex: 1;
      margin-right: 10px;
    }

    .form-group:last-child {
      margin-right: 0;
    }

    .form-group input,
    .form-group select {
      width: 100%;
    }

    .button-group {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
    }

    .btn {
      height: 50%;
      /* 버튼 높이를 입력 필드와 동일하게 설정 */
    }

    .container {
      padding: 0;
      width: 100%;
      max-width: none;
      /* 부트스트랩의 max-width 제거 */
      margin: 0;
      /* 마진 제거 */
    }

    .search-section {
      margin: 0;
      border-radius: 0;
    }

    .form-section {
      margin-bottom: 0;
      padding: 15px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      border-left: 0;
      border-right: 0;
      border-radius: 0;
    }

    .search-form-container {
      margin-bottom: 20px;
    }

    /* 선택된 항목 스타일 */
    .result-item.selected {
      background-color: #e3f2fd;
    }

    .result-item:hover {
      background-color: #f5f5f5;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 검색 섹션 컨테이너 -->
    <div class="search-section form-section">
      <div class="search-form-container">
        <form id="searchForm">
          <div class="form-row">
            <div class="form-group">
              <label for="subjectName">과목명</label>
              <input type="text" class="form-control" id="subjectName" name="subjectName" placeholder="과목명을 입력하세요">
            </div>
            <div class="form-group">
              <label for="curriculumName">교육과정명</label>
              <input type="text" class="form-control" id="curriculumName" name="curriculumName"
                placeholder="교육과정명을 입력하세요">
            </div>
            <div class="form-group d-flex align-items-end">
              <button type="submit" class="btn btn-primary">검색</button>
            </div>
          </div>
        </form>
      </div>

      <div class="result-container">
        <div class="result-header">
          <div></div>
          <div>과목명</div>
          <div>교육과정명</div>
          <div>학점</div>
          <div>학기</div>
          <div>이수 구분</div>
        </div>
        <div class="result-list">
        </div>
      </div>
    </div>

    <!-- 강의 생성 폼 -->
    <form id="lectureForm" class="form-section">
      <div class="form-row">
        <div class="form-group">
          <label for="lectureName">강의명</label>
          <input type="text" class="form-control" id="lectureName" name="lectureName" placeholder="강의명을 입력하세요">
        </div>
        <div class="form-group">
          <label for="professorName">교수명</label>
          <input type="text" class="form-control" id="professorName" name="professorName" th:value="${member.name}"
            readonly>
        </div>
        <div class="form-group">
          <label for="maxStudents">인원수</label>
          <input type="number" class="form-control" id="maxStudents" name="maxStudents" placeholder="인원수를 입력하세요">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="selectedSubjectName">과목명</label>
          <input type="text" class="form-control" id="selectedSubjectName" name="subjectName" placeholder="선택한 과목명"
            readonly>
        </div>
        <div class="form-group">
          <label for="selectedCurriculumName">교육과정명</label>
          <input type="text" class="form-control" id="selectedCurriculumName" name="curriculumName"
            placeholder="선택한 교육과정명" readonly>
        </div>
      </div>
      <input type="hidden" id="curriculumSubjectId" name="curriculumSubjectId" />
      <div class="button-group">
        <button type="submit" class="btn btn-primary">강의 개설</button>
      </div>
    </form>
  </div>


  <script>
    $(document).ready(function () {
      $('#searchForm').on('submit', function (event) {
        event.preventDefault();
        const formData = $(this).serialize();

        $.ajax({
          url: '/api/curriculum-subjects/search',
          type: 'GET',
          data: formData,
          success: function (data) {
            $('.result-list').empty();

            if (data.length === 0) {
              alert('검색 결과가 없습니다.');
            } else {
              data.forEach(function (subject) {
                $('.result-list').append(`
                  <div class="result-item" style="cursor: pointer;" 
                       data-subject-name="${subject.subjectName}"
                       data-curriculum-name="${subject.curriculumName}"
                       data-curriculum-subject-id="${subject.curriculumSubjectId}">
                    <div></div>
                    <div>${subject.subjectName}</div>
                    <div>${subject.curriculumName || '정보 없음'}</div>
                    <div>${subject.subjectCredits || '정보 없음'}</div>
                    <div>${subject.semesterName || '정보 없음'}</div>
                    <div>${subject.subjectTypeName || '정보 없음'}</div>
                  </div>
                `);
              });
            }
          },
          error: function () {
            alert('검색 중 오류가 발생했습니다.');
          }
        });
      });

      // 검색 결과 항목 클릭 이벤트
      $(document).on('click', '.result-item', function () {
        const subjectName = $(this).data('subject-name');
        const curriculumName = $(this).data('curriculum-name');
        const curriculumSubjectId = $(this).data('curriculum-subject-id');

        $('#selectedSubjectName').val(subjectName);
        $('#selectedCurriculumName').val(curriculumName);
        $('#curriculumSubjectId').val(curriculumSubjectId);

        // 선택된 항목 하이라이트
        $('.result-item').removeClass('selected');
        $(this).addClass('selected');
      });

      $('#lectureForm').on('submit', function (event) {
        event.preventDefault(); // 기본 폼 제출 방지

        const formData = {
          lectureName: $('#lectureName').val(),
          maxStudents: parseInt($('#maxStudents').val()),
          curriculumSubjectId: $('#curriculumSubjectId').val()
        };

        $.ajax({
          url: '/api/lecture/create',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify(formData),
          success: function (response) {
            alert(response); // 성공 메시지 표시
            // 추가적인 성공 처리 로직 (예: 폼 초기화)
          },
          error: function (xhr) {
            alert(xhr.responseText); // 에러 메시지 표시
          }
        });
      });
    });
  </script>
</body>

</html>