<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>강의 개설 승인</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" th:href="@{/css/iframe/curriculum/search-container.css}">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<style>
  .result-container {
    max-height: 400px;
    border: 1px solid #ddd;
    border-radius: 4px;
    width: calc(100% - 60px);  /* 전체 너비에서 좌우 여백 30px씩 뺌 */
    margin: 20px 30px;  /* 상하 20px, 좌우 30px 여백 */
  }

  .result-wrapper {
    max-height: calc(300px - 40px);
    overflow-y: auto;
    position: relative;
  }

  .result-header {
    height: 40px;
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
    gap: 20px;
    background-color: #f9f9f9;
    padding: 10px 20px;
    border-bottom: 1px solid #ddd;
  }

  .result-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
    gap: 20px;
    padding: 10px 20px;
    border-bottom: 1px solid #ddd;
    cursor: pointer;  /* 클릭 가능함을 표시 */
  }

  .result-row:hover {
    background-color: #f5f5f5;
  }
</style>
<body>
<!-- 검색 섹션 -->
<div class="search-container">
  <div class="input-group">
    <label for="searchDept">학과명</label>
    <input type="text" id="searchDept" placeholder="학과명을 입력하세요">
  </div>
  <div class="input-group">
    <label for="searchProf">교수명</label>
    <input type="text" id="searchProf" placeholder="교수명을 입력하세요">
  </div>
  <button type="button">검색</button>
</div>

<!-- 검색 결과 섹션 -->
<div class="result-container">
  <div class="result-header">
    <div>강의명</div>
    <div>교수명</div>
    <div>인원수</div>
    <div>학과</div>
    <div>상태</div>
  </div>
  <div class="result-wrapper">
    <!-- 검색 결과 항목들이 여기에 들어갑니다 -->
  </div>
</div>

<!-- 강의 정보 입력 섹션 -->
<div class="search-container" style="margin-top: 20px;">
  <!-- 기존 필드들 유지 -->
  <div class="input-group">
    <label for="lectureName">강의명</label>
    <input type="text" id="lectureName" readonly>
  </div>
  <div class="input-group">
    <label for="professorName">교수명</label>
    <input type="text" id="professorName" readonly>
  </div>
  <div class="input-group">
    <label for="maxStudents">인원수</label>
    <input type="text" id="maxStudents" readonly>
  </div>
  <!-- 건물 선택 추가 -->
  <div class="input-group">
    <label for="building">건물</label>
    <select id="building">
      <option value="">건물 선택</option>
      <option value="ONE">1호관</option>
      <option value="TWO">2호관</option>
      <option value="THREE">3호관</option>
      <option value="FOUR">4호관</option>
      <option value="FIVE">5호관</option>
    </select>
  </div>
  <!-- 강의실 선택 추가 -->
  <div class="input-group">
    <label for="classroom">강의실</label>
    <select id="classroom">
      <option value="">강의실 선택</option>
    </select>
  </div>
  <div class="input-group">
    <label for="lectureWeek">강의 주차</label>
    <select id="lectureWeek">
      <option value="15">15주차</option>
      <option value="16">16주차</option>
    </select>
  </div>
  <div class="input-group">
    <label for="lectureDays">강의 요일</label>
    <select id="lectureDays">
      <option value="MONDAY">월요일</option>
      <option value="TUESDAY">화요일</option>
      <option value="WEDNESDAY">수요일</option>
      <option value="THURSDAY">목요일</option>
      <option value="FRIDAY">금요일</option>
    </select>
  </div>
  <div class="input-group">
    <label for="startTime">시작 교시</label>
    <select id="startTime">
      <option value="PERIOD_FIRST">1교시</option>
      <option value="PERIOD_SECOND">2교시</option>
      <option value="PERIOD_THIRD">3교시</option>
      <option value="PERIOD_FOURTH">4교시</option>
      <option value="PERIOD_FIFTH">5교시</option>
      <option value="PERIOD_SIXTH">6교시</option>
      <option value="PERIOD_SEVENTH">7교시</option>
      <option value="PERIOD_EIGHTH">8교시</option>
      <option value="PERIOD_NINTH">9교시</option>
    </select>
  </div>
  <div class="input-group">
    <label for="endTime">종료 교시</label>
    <select id="endTime">
      <option value="PERIOD_FIRST">1교시</option>
      <option value="PERIOD_SECOND">2교시</option>
      <option value="PERIOD_THIRD">3교시</option>
      <option value="PERIOD_FOURTH">4교시</option>
      <option value="PERIOD_FIFTH">5교시</option>
      <option value="PERIOD_SIXTH">6교시</option>
      <option value="PERIOD_SEVENTH">7교시</option>
      <option value="PERIOD_EIGHTH">8교시</option>
      <option value="PERIOD_NINTH">9교시</option>
    </select>
  </div>
  <div style="width: 100%; text-align: right; margin-top: 20px;">
    <button type="button" class="btn btn-primary">승인</button>
  </div>
</div>

<script>
  // 기존 스크립트 유지
  function selectLecture(element) {
    const lectureName = element.children[0].textContent;
    const professorName = element.children[1].textContent;
    const maxStudents = element.children[2].textContent;

    document.getElementById('lectureName').value = lectureName;
    document.getElementById('professorName').value = professorName;
    document.getElementById('maxStudents').value = maxStudents;

    const rows = document.getElementsByClassName('result-row');
    for (let row of rows) {
      row.style.backgroundColor = '';
    }
    element.style.backgroundColor = '#f1f1f1';
  }

  // 검색 버튼 클릭 이벤트 처리
  document.querySelector('.search-container button').addEventListener('click', function() {
    const deptName = document.getElementById('searchDept').value;
    const professorName = document.getElementById('searchProf').value;

    // 검색 API 호출
    fetch(`/api/lecture/search?deptName=${encodeURIComponent(deptName)}&professorName=${encodeURIComponent(professorName)}`)
            .then(response => response.json())
            .then(lectures => {
              if (lectures.length === 0) {
                alert('검색 결과가 없습니다.');
                return;
              }

              const resultWrapper = document.querySelector('.result-wrapper');  // wrapper로 변경
              resultWrapper.innerHTML = '';  // wrapper 내용만 삭제

              // 검색 결과 표시
              lectures.forEach(lecture => {
                const row = document.createElement('div');
                row.className = 'result-row';
                row.onclick = function() { selectLecture(this); };
                row.innerHTML = `
                    <div>${lecture.lectureName}</div>
                    <div>${lecture.professorName}</div>
                    <div>${lecture.maxStudents}</div>
                    <div>${lecture.deptName}</div>
                    <div>${lecture.lectureStatus}</div>
                `;
                resultWrapper.appendChild(row);  // wrapper에 추가
              });
            });
  });

  document.getElementById('building').addEventListener('change', function() {
    const buildingCode = this.value;
    const classroomSelect = document.getElementById('classroom');
    classroomSelect.innerHTML = '<option value="">강의실 선택</option>';

    if (buildingCode) {
      fetch(`/api/classrooms/${buildingCode}`)
              .then(response => response.json())
              .then(classrooms => {
                classrooms.forEach(classroom => {
                  const option = document.createElement('option');
                  option.value = classroom.facilityId;
                  option.textContent = classroom.facilityName;
                  classroomSelect.appendChild(option);
                });
              });
    }
  });

</script>
</body>
</html>