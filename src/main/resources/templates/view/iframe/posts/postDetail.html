<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>게시물 상세</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .float-right {
      float: right;
    }
  </style>
</head>
<body>
<div class="container mt-5">
  <h1>
    게시물 상세
    <a href="iframe:/iframe/posts/view" class="btn btn-secondary float-right">목록으로</a>
  </h1>
  <div class="card">
    <div class="card-body">
      <h5 class="card-title" th:text="${post.title}">제목</h5>
      <p class="card-text" th:text="${post.content}">내용</p>
      <p class="card-text">작성자: 익명</p>
      <p class="card-text" th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">작성일</p>
    </div>
  </div>

  <hr>

  <h4>댓글 작성</h4>
  <form th:action="@{/iframe/posts/{postId}/comments(postId=${post.postId})}" method="post" id="commentForm">
    <div class="form-group">
      <input type="text" name="content" class="form-control" id="commentInput" placeholder="댓글을 입력하세요" required>
    </div>
  </form>

  <hr>

  <h4>댓글</h4>
  <div th:each="comment : ${post.comments}">
    <div class="card mt-3">
      <div class="card-body">
        <p class="card-text">작성자: 익명<br>
        <p class="card-text mt-2" th:text="${comment.content}">댓글 내용</p>
        <p class="card-text" th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}">작성일</p>
        <form th:if="${@postService.isCommentAuthor(comment)}" 
              th:action="@{/iframe/posts/{postId}/comments/{commentId}/delete(postId=${post.postId}, commentId=${comment.postId})}" 
              method="post" class="d-inline">
          <button type="button" class="btn btn-danger btn-sm" onclick="confirmDelete(this.form)">삭제</button>
        </form>
      </div>
    </div>
  </div>

  <hr>
</div>

<script>
  document.getElementById('commentInput').addEventListener('keydown', function(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
      event.preventDefault();
      document.getElementById('commentForm').submit();
    }
  });

  function confirmDelete(form) {
    if (confirm("정말로 댓글을 삭제하시겠습니까?")) {
      form.submit();
    }
  }
</script>
</body>
</html>